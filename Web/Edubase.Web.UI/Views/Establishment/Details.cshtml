@using Edubase.Web.UI.Helpers
@using Edubase.Web.UI.Models
@using Edubase.Common
@model EstablishmentDetailViewModel
@{
    ViewBag.Title = Model.Establishment.Name;
    ViewBag.PageClass = "school-details";
    ViewBag.HideLogo = true;
}

@if (Model.ShowPendingMessage)
{
    <div class="pending-updates-message">
        <div class="tick"></div>
        Updates require approval. The Data Owner has been notified.
        <div class="cross" onclick="$(this).parent().hide();"></div>
    </div>
}
else if (Model.UserHasPendingApprovals)
{
    <div class="pending-updates-message">
        <div class="exclaim"></div>
        You have pending approvals awaiting for this school. @Html.ActionLink("Approve now.", "Index", "Approval", new { urn = Model.Establishment.Urn }, null)
        <div class="cross" onclick="$(this).parent().hide();"></div>
    </div>
}

@if (Model.PendingChanges.Any())
{
    <div class="pending-updates">
        <div class="icon" style="height:24px;">!</div>
        <h3>Data update@(Model.PendingChanges.Count > 1 ? "s" : "") pending Data Owner approval</h3>
        @foreach (var item in Model.PendingChanges)
        {
            <div class="group">
                <div>Data field: @item.DataField</div>
                <div>Old: @(item.OldValue.Clean() ?? "(nothing)")</div>
                <div>New: @(item.NewValue.Clean() ?? "(nothing)")</div>
            </div>
        }
    </div>
}

<h1 class="heading-large">@Html.PendingUpdateFor(x => x.Name) @Model.Establishment.Name</h1>
@if (Model.UserCanEdit)
{
    @Html.ActionLink("Edit", "Edit", "Establishment", new { id = Model.Establishment.Urn }, new { @class = "button mobile-full-width" })
}

<div class="column-full">
    <div class="grid-row summary">
        <table class="borderless">
            <caption class="visually-hidden">@Model.Establishment.Name information</caption>
            <tr>
                <th scope="row">Address:</th>
                <td>@Model.Establishment.Address</td>
            </tr>
            <tr>
                <th scope="row">Local authority:</th>
                <td>
                    @Html.PendingUpdateFor(x => x.LocalAuthorityId)
                    @if (Model.Establishment.LocalAuthorityId.HasValue)
                    {
                        <a href="/Search/SearchByLaName?searchTerm=@Model.Establishment.LocalAuthorityId">
                            @Html.NameFor(x => x.Establishment.LocalAuthorityId)
                        </a> 
                        <text>(@Model.Establishment.LocalAuthorityId)</text>
                    }
                </td>
            </tr>

            @if (Model.DisplayPolicy.HeadteacherDetails)
            {
                <tr>
                    <th scope="row">Headteacher/Principal:</th>
                    <td>
                        @(Html.PendingUpdatesFor("HeadTitleId", "HeadFirstName", "HeadLastName"))
                        @Html.NameFor(x => x.Establishment.HeadTitleId) @Model.Establishment.HeadFirstName @Model.Establishment.HeadLastName
                    </td>
                </tr>
            }
            
            @if (Model.DisplayPolicy.AgeRange)
            {
                <tr>
                    <th scope="col">Age range:</th>
                    <td>
                        @(Html.PendingUpdatesFor("StatutoryLowAge", "StatutoryHighAge"))
                        @if (Model.Establishment.StatutoryLowAge.HasValue && Model.Establishment.StatutoryHighAge.HasValue)
                        {
                            <text>@(Model.Establishment.StatutoryLowAge) to @(Model.Establishment.StatutoryHighAge)</text>
                        }
                    </td>
                </tr>
            }
            
            <tr>
                <th scope="row">Phase of education:</th>
                <td>
                    @(Html.PendingUpdatesFor(x=>x.EducationPhaseId))
                    @Html.NameFor(x => x.Establishment.EducationPhaseId)
                </td>
            </tr>
            
            <tr>
                <th scope="row">School type</th>
                <td>
                    @(Html.PendingUpdatesFor(x => x.TypeId))
                    @Html.NameFor(x => x.Establishment.TypeId)
                </td>
            </tr>
            
            @if (Model.DisplayPolicy.FurtherEducationType)
            {
                <tr>
                    <th scope="row">Further Education type:</th>
                    <td>
                        @Html.NameFor(x => x.Establishment.FurtherEducationTypeId)
                    </td>
                </tr>
            }

            @if (Model.DisplayPolicy.GroupDetails && Model.Group != null)
            {
                <tr>
                    <th scope="row">@(Model.GroupFieldLabel):</th>
                    <td>
                        @Html.ActionLink(Model.Group.Name, "Details", "Group", new { id = Model.Group.GroupUID }, null)
                    </td>
                </tr>
            }

            @if (Model.DisplayPolicy.GenderOfEntry)
            {
                <tr>
                    <th scope="row">Gender of entry:</th>
                    <td>
                        @(Html.PendingUpdatesFor(x => x.GenderId))
                        @Html.NameFor(x => x.Establishment.GenderId)
                    </td>
                </tr>
            }

            <tr>
                <th scope="row">ID:</th>
                <td>
                    URN: @Model.Establishment.Urn, 
                    @if (Model.DisplayPolicy.LAESTAB)
                    {
                        <text>DfE number: @Model.Establishment.LAESTAB<br /></text>
                    }
                    UKPRN: @Model.Establishment.UKPRN
                </td>
            </tr>

            <tr>
                <th scope="row">Establishment status:</th>
                <td>
                    @(Html.PendingUpdatesFor(x => x.StatusId))
                    @if (Model.IsClosed)
                    {
                        <span style="color:red;">
                            @Html.NameFor(x => x.Establishment.StatusId)
                        </span>
                    }
                    else
                    {
                        @Html.NameFor(x => x.Establishment.StatusId)
                    }
                </td>
            </tr>

            @if (Model.DisplayPolicy.AdmissionsPolicy)
            {
                <tr>
                    <th scope="row">Admissions policy:</th>
                    <td>
                        @(Html.PendingUpdatesFor(x => x.AdmissionsPolicyId))
                        @Html.NameFor(x => x.Establishment.AdmissionsPolicyId)
                    </td>
                </tr>
            }

            @if (Model.DisplayPolicy.WebsiteAddress)
            {
                <tr>
                    <th scope="row">Website:</th>
                    <td>
                        <a href="@Model.Establishment.Contact.WebsiteAddress" target="_blank">@Model.Establishment.Contact.WebsiteAddress</a>
                    </td>
                </tr>
            }

             <tr><th scope="row">Telephone:</th><td>@Model.Establishment.Contact.TelephoneNumber</td></tr>
            
            @if (Model.DisplayPolicy.OfstedRatingDetails)
            {
                <tr>
                    <th scope="row">Ofsted rating:</th>
                    <td>
                        @Model.Establishment.OfstedRating  
                        @if (Model.Establishment.OfstedInspectionDate.HasValue)
                        {
                            <span>(Last inspection: @(Model.Establishment.OfstedInspectionDate?.ToString("dd MMMM yyyy")))</span>
                        }
                        <br />
                        <a href="@Model.OfstedRatingReportUrl" target="_blank" rel="external">Ofsted report</a>
                    </td>
                </tr>
            }

            @if (Model.DisplayPolicy.Inspectorate)
            {
                <tr>
                    <th scope="row">Inspectorate:</th>
                    <td>
                        @Html.NameFor(x => x.Establishment.InspectorateId)
                    </td>
                </tr>
            }

            @if (Model.DisplayPolicy.Proprietor)
            {
                <tr><th scope="row">Proprietor's name:</th><td>@Model.Establishment.ProprietorName</td></tr>
            }

        </table>

        <div class="map-container">
            <a href="#map" id="map-toggle" class="expanding-content-trigger map-toggle">Show map</a>
            <div id="map" class="school-detail-map"
                 data-latlng="[@(Model.Establishment.Location?.Longitude),@(Model.Establishment.Location?.Latitude)]"
                 data-school-name="@Model.Establishment.Name"
                 data-school-address="@Model.Establishment.Address"></div>
        </div>
    </div>

    <div class="grid-row horizontal-tabs-wrapper">
        <div class="tab-wrap">
            <ul class="horizontal-tabs">
                <li>
                    <a href="#school-dashboard" class="horizontal-tab">Details</a>
                </li>
                <li>
                    <a href="#school-contact" class="horizontal-tab">Contact</a>
                </li>
                <li>
                    <a href="#school-governance" class="horizontal-tab">Governance</a>
                </li>
                <li>
                    <a href="#school-links" class="horizontal-tab">Links</a>
                </li>
                @if (Model.DisplayPolicy.LocationDetails)
                {
                    <li>
                        <a href="#school-location" class="horizontal-tab">Location</a>
                    </li>
                }@if (Model.ChangeHistory != null)
                {
                    <li>
                        <a href="#school-change-history" class="horizontal-tab">Changes</a>
                    </li>
                }
            </ul>
        </div>


        <div class="tab-content-wrapper horizontal-tabs-content">
            <div id="school-dashboard" class="tab-content">
                <table class="borderless">
                    <caption class="visually-hidden">@Model.Establishment.Name details</caption>
                    
                    @if (Model.DisplayPolicy.ReligiousCharacter)
                    {
                        <tr>
                            <th scope="row">Religious character:</th>
                            <td>
                                @Html.NameFor(x => x.Establishment.ReligiousCharacterId)
                            </td>
                        </tr>
                    }

                    @if (Model.DisplayPolicy.Diocese)
                    {
                        <tr>
                            <th scope="row">Diocese:</th>
                            <td>
                                @Html.NameFor(x => x.Establishment.DioceseId)
                            </td>
                        </tr>
                    }

                    @if (Model.DisplayPolicy.ReligiousEhtos)
                    {
                        <tr>
                            <th scope="row">Religious ehtos:</th>
                            <td>
                                @Html.NameFor(x => x.Establishment.ReligiousEthosId)
                            </td>
                        </tr>
                    }

                    @if (Model.DisplayPolicy.BoardingProvision)
                    {
                        <tr>
                            <th scope="row">Boarders:</th>
                            <td>@Html.NameFor(x => x.Establishment.ProvisionBoardingId)</td>
                        </tr>
                    }

                    @if (Model.DisplayPolicy.BoardingProvision)
                    {
                        <tr>
                            <th scope="row">Nursery provision:</th>
                            <td>@Html.NameFor(x => x.Establishment.ProvisionNurseryId)</td>
                        </tr>
                    }

                    @if (Model.DisplayPolicy.OfficialSixthFormProvision)
                    {
                        <tr>
                            <th scope="row">Official sixth form:</th>
                            <td>@Html.NameFor(x => x.Establishment.ProvisionOfficialSixthFormId)</td>
                        </tr>
                    }

                    @if (Model.DisplayPolicy.Capacity)
                    {
                        <tr>
                            <th scope="row">School capacity:</th>
                            <td>@Model.Establishment.Capacity</td>
                        </tr>
                    }

                    @if (Model.DisplayPolicy.Section41Approved)
                    {
                        <tr>
                            <th scope="row">Section 41 approved:</th>
                            <td>@Html.NameFor(x => x.Establishment.Section41ApprovedId)</td>
                        </tr>
                    }
                    
                    <tr>
                        <th scope="row">Open date / Reason:</th>
                        <td>
                            @(Model.Establishment.OpenDate?.ToString("dd/MM/yyyy") ?? "Not recorded")<br />
                            @Html.NameFor(x => x.Establishment.ReasonEstablishmentOpenedId)
                        </td>
                    </tr>

                    @if (Model.DisplayPolicy.CloseDate)
                    {
                        <tr>
                            <th scope="row">Close date / Reason:</th>
                            <td>
                                @(Model.Establishment.CloseDate?.ToString("dd/MM/yyyy"))<br />
                                @Html.NameFor(x => x.Establishment.ReasonEstablishmentClosedId)
                            </td>
                        </tr>
                    }


                    @if (Model.DisplayPolicy.SpecialClasses)
                    {
                        <tr>
                            <th scope="row">Special classes:</th>
                            <td>@Html.NameFor(x => x.Establishment.ProvisionSpecialClassesId)</td>
                        </tr>
                    }


                    @if (Model.DisplayPolicy.SENStat)
                    {
                        <tr>
                            <th scope="row">Number of Special Pupils Under a SEN Statement/EHCP:</th>
                            <td>@Model.Establishment.SENStat</td>
                        </tr>
                    }

                    @if (Model.DisplayPolicy.SENNoStat)
                    {
                        <tr>
                            <th scope="row">Number of Special Pupils Not Under a SEN Statement/EHCP:</th>
                            <td>@Model.Establishment.SENNoStat</td>
                        </tr>
                    }


                    @if (Model.DisplayPolicy.MainEmailAddress)
                    {
                        <tr>
                            <th scope="row">Email:</th>
                            <td>@Model.Establishment.Contact.EmailAddress</td>
                        </tr>
                    }

                    @if (Model.DisplayPolicy.AlternativeEmailAddress)
                    {
                        <tr>
                            <th scope="row">Email:</th>
                            <td>@Model.Establishment.ContactAlt.EmailAddress</td>
                        </tr>
                    }

                    @if (Model.DisplayPolicy.LastChangedDate)
                    {
                        <tr>
                            <th scope="row">Last Change:</th>
                            <td>@(Model.Establishment.LastChangedDate?.ToString("dd/MM/yyyy"))</td>
                        </tr>
                    }

                    @if (Model.DisplayPolicy.SENProvisions)
                    {
                        <tr>
                            <th scope="row">Type of SEN provision:</th>
                            <td>
                                @if (Model.Establishment.SEN1Id.HasValue)
                                {
                                    <text>@Html.NameFor(x => x.Establishment.SEN1Id)<br /></text>
                                }
                                @if (Model.Establishment.SEN2Id.HasValue)
                                {
                                    <text>@Html.NameFor(x => x.Establishment.SEN2Id)<br /></text>
                                }
                                @if (Model.Establishment.SEN3Id.HasValue)
                                {
                                    <text>@Html.NameFor(x => x.Establishment.SEN3Id)<br /></text>
                                }
                                @if (Model.Establishment.SEN4Id.HasValue)
                                {
                                    <text>@Html.NameFor(x => x.Establishment.SEN4Id)<br /></text>
                                }
                            </td>
                        </tr>
                    }

                    @if (Model.DisplayPolicy.TeenageMothers)
                    {
                        <tr>
                            <th scope="row">Teenage mothers:</th>
                            <td>@Html.NameFor(x => x.Establishment.TeenageMothersProvisionId)</td>
                        </tr>
                    }

                    @if (Model.DisplayPolicy.TeenageMothersCapacity)
                    {
                        <tr>
                            <th scope="row">Teenage mothers places:</th>
                            <td>@Model.Establishment.TeenageMothersCapacity</td>
                        </tr>
                    }

                    @if (Model.DisplayPolicy.ChildcareFacilities)
                    {
                        <tr>
                            <th scope="row">Childcare facilities:</th>
                            <td>@Html.NameFor(x => x.Establishment.ChildcareFacilitiesId)</td>
                        </tr>
                    }

                    @if (Model.DisplayPolicy.SENFacilities)
                    {
                        <tr>
                            <th scope="row">SEN facilities:</th>
                            <td>@Html.NameFor(x => x.Establishment.PRUSENId)</td>
                        </tr>
                    }

                    @if (Model.DisplayPolicy.PupilsWithEBD)
                    {
                        <tr>
                            <th scope="row">Pupils with EBD:</th>
                            <td>@Html.NameFor(x => x.Establishment.PRUEBDId)</td>
                        </tr>
                    }

                    @if (Model.DisplayPolicy.PRUNumberOfPlaces)
                    {
                        <tr>
                            <th scope="row">Number of places:</th>
                            <td>@Model.Establishment.PlacesPRU</td>
                        </tr>
                    }

                    @if (Model.DisplayPolicy.PRUFullTimeProvision)
                    {
                        <tr>
                            <th scope="row">Full time provision :</th>
                            <td>@Html.NameFor(x => x.Establishment.PruFulltimeProvisionId)</td>
                        </tr>
                    }


                    @if (Model.DisplayPolicy.PRUPupilsEducatedByOthers)
                    {
                        <tr>
                            <th scope="row">Pupils educated by other providers:</th>
                            <td>@Model.Establishment.PruEducatedByOthersId</td>
                        </tr>
                    }


                    @if (Model.DisplayPolicy.TypeOfResourcedProvision)
                    {
                        <tr>
                            <th scope="row">Type of resourced provision:</th>
                            <td>@Html.NameFor(x => x.Establishment.TypeOfResourcedProvisionId)</td>
                        </tr>
                    }

                    @if (Model.DisplayPolicy.ResourcedProvisionOnRoll)
                    {
                        <tr>
                            <th scope="row">Resourced provision number on roll:</th>
                            <td>@Model.Establishment.ResourcedProvisionOnRoll</td>
                        </tr>
                    }

                    @if (Model.DisplayPolicy.ResourcedProvisionCapacity)
                    {
                        <tr>
                            <th scope="row">Resourced provision capacity:</th>
                            <td>@Model.Establishment.ResourcedProvisionCapacity</td>
                        </tr>
                    }

                    @if (Model.DisplayPolicy.SenUnitOnRoll)
                    {
                        <tr>
                            <th scope="row">SEN Unit number on roll:</th>
                            <td>@Model.Establishment.SenUnitOnRoll</td>
                        </tr>
                    }
                    
                    @if (Model.DisplayPolicy.SenUnitCapacity)
                    {
                        <tr>
                            <th scope="row">SEN Unit capacity:</th>
                            <td>@Model.Establishment.SenUnitCapacity</td>
                        </tr>
                    }


                    @if (Model.DisplayPolicy.BSOInspectorate)
                    {
                        <tr>
                            <th scope="row">Inspectorate name:</th>
                            <td>@Html.NameFor(x => x.Establishment.BSOInspectorateId)</td>
                        </tr>
                    }

                    @if (Model.DisplayPolicy.BSOInspectorateReport)
                    {
                        <tr>
                            <th scope="row">Inspectorate report:</th>
                            <td>@Model.Establishment.BSOInspectorateReportUrl</td>
                        </tr>
                    }

                    @if (Model.DisplayPolicy.BSODateOfLastInspectionVisit)
                    {
                        <tr>
                            <th scope="row">Date of Last Inspection Visit:</th>
                            <td>@(Model.Establishment.BSODateOfLastInspectionVisit?.ToString("dd/MM/yyyy"))</td>
                        </tr>
                    }

                    @if (Model.DisplayPolicy.BSODateOfNextInspectionVisit)
                    {
                        <tr>
                            <th scope="row">Date of Next Inspection Visit:</th>
                            <td>@(Model.Establishment.BSODateOfNextInspectionVisit?.ToString("dd/MM/yyyy"))</td>
                        </tr>
                    }


                </table>

            </div>
            <div id="school-contact" class="tab-content">
                <table class="borderless">
                    <caption class="visually-hidden">Contact information for @Model.Establishment.Name</caption>
                    <tr>
                        <th scope="row">School website</th>
                        <td>@Model.Establishment.Contact.WebsiteAddress</td>
                    </tr>
                    <tr>
                        <th scope="row">Main email</th>
                        <td>@Model.Establishment.Contact.EmailAddress</td>
                    </tr>
                    <tr>
                        <th scope="row">Alternative email</th>
                        <td>@Model.Establishment.ContactAlt.EmailAddress</td>
                    </tr>
                    <tr>
                        <th scope="row">Telephone number</th>
                        <td>@Model.Establishment.Contact.TelephoneNumber</td>
                    </tr>
                </table>
            </div>
            <div id="school-governance" class="tab-content">

                @if (!Model.Governors.Any() && !Model.HistoricalGovernors.Any())
                {
                    <p>There is no governance information for this establishment</p>
                }
                else
                {
                    if (Model.Governors.Any())
                    {
                        @Html.Partial("_Governors", Model.Governors)
                        if (Model.HistoricalGovernors.Any())
                        {
                            <br />
                            <hr />
                            <br />
                        }
                    }

                    if (Model.HistoricalGovernors.Any())
                    {
                        <h3 class="bold-xsmall">Historic (left with past 12 months)</h3>
                        @Html.Partial("_Governors", Model.HistoricalGovernors)
                    }
                }

            </div>
            <div id="school-links" class="tab-content">
                    @if (Model.LinkedEstablishments.Any())
                    {
                        <table class="estab-links mi">
                            <thead>
                                <tr>
                                    <th>URN</th>
                                    <th>Establishment name</th>
                                    <th>Type of link</th>
                                    <th>Date linked</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var l in Model.LinkedEstablishments)
                                {
                                    <tr>
                                        <td>@Html.ActionLink(l.Urn.ToString(), "Details", new { id = l.Urn })</td>
                                        <td>@Html.ActionLink(l.Name, "Details", new { id = l.Urn })</td>
                                        <td>@l.Type</td>
                                        <td>@(l.LinkDate?.ToString("dd/MM/yyyy") ?? "None recorded")</td>
                                    </tr>
                                }
                            </tbody>
                        </table>

                        <div class="mvo">
                            @foreach (var l in Model.LinkedEstablishments)
                            {
                                <table class="estab-links">
                                    <tbody>
                                        <tr>
                                            <th>URN</th>
                                            <td>@Html.ActionLink(l.Urn.ToString(), "Details", new { id = l.Urn })</td>
                                        </tr>
                                        <tr>
                                            <th>Establishment name</th>
                                            <td>@Html.ActionLink(l.Name, "Details", new { id = l.Urn })</td>
                                        </tr>
                                        <tr>
                                            <th>Type of link</th>
                                            <td>@l.Type</td>
                                        </tr>
                                        <tr>
                                            <th>Date linked</th>
                                            <td>@(l.LinkDate?.ToString("dd/MM/yyyy") ?? "None recorded")</td>
                                        </tr>
                                    </tbody>
                                </table>
                                <br />
                            }
                        </div>
                    
                    }
                    else
                    {
                        <p>There are no linked establishments</p>
                    }
            </div>

            @if (Model.DisplayPolicy.LocationDetails)
            {
                <div id="school-location" class="tab-content">
                    <table class="borderless">
                        <caption class="visually-hidden">Location information for @Model.Establishment.Name</caption>
                        <tr>
                            <th scope="row">RSC Region:</th>
                            <td>@Html.NameFor(x => x.Establishment.RSCRegionId)</td>
                        </tr>
                        <tr>
                            <th scope="row">Government Office Region:</th>
                            <td>@Html.NameFor(x => x.Establishment.GovernmentOfficeRegionId)</td>
                        </tr>
                        <tr>
                            <th scope="row">District:</th>
                            <td>@Html.NameFor(x => x.Establishment.AdministrativeDistrictId)</td>
                        </tr>
                        <tr>
                            <th scope="row">Ward:</th>
                            <td>@Html.NameFor(x => x.Establishment.AdministrativeWardId)</td>
                        </tr>
                        <tr>
                            <th scope="row">Parliamentary Constituency:</th>
                            <td>@Html.NameFor(x => x.Establishment.ParliamentaryConstituencyId)</td>
                        </tr>
                        <tr>
                            <th scope="row">Urban/Rural Description:</th>
                            <td>@Html.NameFor(x => x.Establishment.UrbanRuralId)</td>
                        </tr>
                        <tr>
                            <th scope="row">GSS LA Code:</th>
                            <td>@Html.NameFor(x => x.Establishment.GSSLAId)</td>
                        </tr>
                        <tr>
                            <th scope="row">Easting:</th>
                            <td>@Model.Establishment.Easting</td>
                        </tr>
                        <tr>
                            <th scope="row">Northing:</th>
                            <td>@Model.Establishment.Northing</td>
                        </tr>
                        <tr>
                            <th scope="row">Census Ward: </th>
                            <td>@Html.NameFor(x => x.Establishment.CASWardId)</td>
                        </tr>
                        <tr>
                            <th scope="row">Middle Super Output Area (MSOA): </th>
                            <td>@Html.NameFor(x => x.Establishment.MSOAId)</td>
                        </tr>
                        <tr>
                            <th scope="row">Lower Super Output Area (LSOA):</th>
                            <td>@Html.NameFor(x => x.Establishment.LSOAId)</td>
                        </tr>
                    </table>
                </div>
            }

            @if (Model.ChangeHistory != null)
            {
            <div id="school-change-history" class="tab-content approval-data">
                <h2 class="bold-small" style="margin-bottom:8px;">Change History</h2>
                @if (!Model.ChangeHistory.Any())
                {
                    <p>There are no change records available at the moment</p>
                }
                else
                {
                    <table class="approval-items">
                        <thead>
                            <tr>
                                <th>Updated field</th>
                                <th>Old value</th>
                                <th>New value</th>
                                <th>Date changed</th>
                                <th>Date requested</th>
                                <th>Suggested from</th>
                                <th>Approved by</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.ChangeHistory)
                            {
                                <tr>
                                    <td>@item.PropertyName</td>
                                    <td>@item.OldValue</td>
                                    <td>@item.NewValue</td>
                                    <td>@item.EffectiveDateUtc</td>
                                    <td>@item.RequestedDateUtc</td>
                                    <td>@item.OriginatorUserName</td>
                                    <td>@item.ApproverUserName</td>
                                </tr>
                            }
                        </tbody>
                    </table>

                    <ul class="school-results-listing approval-items">
                        @foreach (var item in Model.ChangeHistory)
                        {
                            <li>
                                <dl>
                                    <dt>Updated field:</dt>
                                    <dd>@item.PropertyName</dd>
                                    <dt>Old value:</dt>
                                    <dd>@item.OldValue</dd>
                                    <dt>New value:</dt>
                                    <dd>@item.NewValue</dd>
                                    <dt>Date changed:</dt>
                                    <dd>@item.EffectiveDateUtc</dd>
                                    <dt>Date requested:</dt>
                                    <dd>@item.RequestedDateUtc</dd>
                                    <dt>Suggested from:</dt>
                                    <dd>@item.OriginatorUserName</dd>
                                    <dt>Approved by:</dt>
                                    <dd>@item.ApproverUserName</dd>
                                </dl>
                            </li>
                        }
                    </ul>
                }
            </div>
            }
        </div>
    </div>

</div>
