@using Edubase.Web.UI.Helpers
@using Microsoft.AspNetCore.WebUtilities
@{
    ViewBag.bodyClasses = "schools-search-page search-page";
    ViewBag.hideLogo = true;
    var breadcrumbRoutes = ViewBag.BreadcrumbRoutes as RouteDto[];
}
@section Head
{
    <meta name="robots" content="noindex,nofollow" />
}
@section Breadcrumbs
{
    <div class="govuk-grid-row">
        <div class="govuk-grid-column-full">
            <div class="govuk-breadcrumbs">
                <ol class="govuk-breadcrumbs__list">
                    <li class="govuk-breadcrumbs__list-item">
                        @Html.ActionLink("Home", "Index", "Home", new { area = "" }, new { @class = "govuk-breadcrumbs__link" })
                    </li>
                    @foreach (var item in breadcrumbRoutes)
                    {
                        <li class="govuk-breadcrumbs__list-item">@Html.RouteLink(item.Label, item.RouteName, item.RouteValues,new Dictionary<string, object>(){{"class", "govuk-breadcrumbs__link"}})</li>
                    }
                </ol>
            </div>
        </div>
    </div>
}
<div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
        <h1 id="download-file-ready-heading" class="govuk-heading-l">Download data</h1>
    </div>
    <div class="gias-tabs-wrapper">
        <div class="govuk-grid-column-full">

            <p id="download-file-ready-body" class="govuk-body">Your requested file is ready to download.</p>

            <ul class="govuk-list">
                <li>
                    @{
                        var request = ViewContext.HttpContext.Request;
                        var currentPath = request.Path;
                        var queryParams = request.Query.ToDictionary(kvp => kvp.Key, kvp => kvp.Value.ToString());

                        // Add or update the "start" parameter
                        queryParams["start"] = "true";

                        var downloadUrl = QueryHelpers.AddQueryString(currentPath, queryParams);
                    }

                    <a id="download-button" class="govuk-button" href="@downloadUrl" rel="nofollow">
                        Download
                    </a>
                    @{
                        var downloadType = ViewContext.HttpContext.Request.Query["downloadtype"].ToString().ToUpper();
                    }

                    <p id="download-file-format-body" class="govuk-body">
                        The data is in @downloadType format and will download as a ZIP file. Open the ZIP file to access its content.
                    </p>

                </li>
            </ul>
        </div>
    </div>
</div>
