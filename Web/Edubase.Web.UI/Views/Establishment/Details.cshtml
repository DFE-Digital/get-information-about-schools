@using Edubase.Web.UI.Helpers
@using Edubase.Web.UI.Models
@using Edubase.Common
@using Edubase.Services.Enums
@using Edubase.Web.Resources
@using Microsoft.Ajax.Utilities
@model EstablishmentDetailViewModel
@{
    ViewBag.Title = Model.Establishment.Name;
    ViewBag.PageClass = "school-details";
    ViewBag.HideLogo = true;
}

@if (Model.SearchQueryString.IsNullOrWhiteSpace())
{
    @Html.ActionLink("Home", "Index", "Search", new { area = "" }, new { @class = "home-link" })
}
else
{
    if (Model.SearchSource == "Governors")
    {
        <a href=@($"{Url.Action("Index", "GovernorSearch", new {area = "Governors"})}?{Model.SearchQueryString}") class="home-link">« Back to search results</a>
    }
    else
    {
        <a href=@($"{Url.Action("Index", "EstablishmentsSearch", new {area = "Establishments"})}?{Model.SearchQueryString}") class="home-link">« Back to search results</a>
    }
}

<h1 class="heading-large">@Model.Establishment.Name</h1>
<p class="urn">URN: @Model.Establishment.Urn</p>

<div class="column-full">
    <div class="grid-row horizontal-tabs-wrapper">
        <div class="tab-wrap">
            <ul class="horizontal-tabs">
                @if (Model.TabDisplayPolicy.Details)
                {
                    <li><a href="#school-dashboard" class="horizontal-tab">Details</a></li>
                }

                @if (Model.TabDisplayPolicy.IEBT)
                {
                    <li><a href="#school-iebt" class="horizontal-tab">IEBT</a></li>
                }

                @if (Model.TabDisplayPolicy.Governance)
                {
                    <li><a href="#school-governance" class="horizontal-tab">Governance</a></li>
                }

                @if (Model.TabDisplayPolicy.Links)
                {
                    <li><a href="#school-links" class="horizontal-tab">Links</a></li>
                }

                @if (Model.DisplayPolicy.LocationDetails && Model.TabDisplayPolicy.Location)
                {
                    <li><a href="#school-location" class="horizontal-tab">Location</a></li>
                }

                @if (Model.ChangeHistory != null && Model.TabDisplayPolicy.ChangeHistory)
                {
                    <li><a href="#school-change-history" class="horizontal-tab">Changes</a></li>
                }
            </ul>
        </div>
        <div class="tab-content-wrapper horizontal-tabs-content">
            @{
                if (Model.TabDisplayPolicy.Details)
                {
                    Html.RenderPartial(@"Partials\TabDetails");
                }

                if (Model.TabDisplayPolicy.IEBT)
                {
                    Html.RenderPartial(@"Partials\TabIEBT");
                }

                if (Model.TabDisplayPolicy.Governance)
                {
                    Html.RenderPartial(@"Partials\TabGovernance");
                }

                if (Model.TabDisplayPolicy.Links)
                {
                    Html.RenderPartial(@"Partials\TabLinks");
                }

                if (Model.DisplayPolicy.LocationDetails && Model.TabDisplayPolicy.Location)
                {
                    Html.RenderPartial(@"Partials\TabLocation");
                }

                if (Model.ChangeHistory != null && Model.TabDisplayPolicy.ChangeHistory)
                {
                    Html.RenderPartial(@"Partials\TabChangeHistory");
                }
            }
        </div>
    </div>
</div>

<div class="column-full helptext-container">
@*
    TODO update content for different user states - this is the text for public users
    https://docs.google.com/spreadsheets/d/1fGTT6u3F-CojGt6VqqGpQACju2zATgrCea_ycOzZLYc/edit#gid=1484693369
*@
    <div id="help-text-age-range">
        <h3 class="heading-small">Age range</h3>
        <p>@Model.AgeRangeToolTip</p>
        @if (!Model.AgeRangeToolTipLink.IsNullOrEmpty())
        {
            <p>Link: <a href="@Model.AgeRangeToolTipLink">@Model.AgeRangeToolTipLink</a></p>
        }
    </div>
    
    <div id="help-text-school-capacity">
        <h3 class="heading-small">School capacity</h3>
        <p>@Model.SchoolCapacityToolTip</p>
        @if (!Model.SchoolCapacityToolTipLink.IsNullOrEmpty())
        {
            <p>Link: <a href="@Model.SchoolCapacityToolTipLink">@Model.SchoolCapacityToolTipLink</a></p>
        }
    </div>

</div>
