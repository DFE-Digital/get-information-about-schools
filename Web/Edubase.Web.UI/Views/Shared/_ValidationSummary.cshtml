@model ModelStateDictionary

@if (!Model.IsValid)
{
    <div class="error-summary">
        <h2 class="heading-medium error-summary-heading">Incorrect or missing details</h2>
        <ul class="error-summary-list">

            @{
                var validationResult = (FluentValidation.Results.ValidationResult) ViewBag.FVErrors;
                if (validationResult != null)
                {
                    // fluentValidation errors
                    foreach (var modelError in validationResult.Errors)
                    {
                        <li class="error-message"><a href="#@modelError.PropertyName">@(modelError.CustomState?.ToString() ?? modelError.ErrorMessage)</a></li>
                    }
                }
                else
                {
                    // traditional model validation
                    foreach (var modelError in Model.Keys.SelectMany(key => this.Model[key].Errors.Select(x => Tuple.Create(key, x.ErrorMessage))))
                    {
                        <li class="error-message"><a href="#@modelError.Item1">@modelError.Item2</a></li>
                    }
                }
            }

        </ul>
    </div>
}
