<template>
    <div v-bind:class="['govuk-form-group', filterSearchError ? 'govuk-form-group--error': '']">
        <span class="govuk-error-message" v-show="filterSearchError">
            Enter a field name to search
        </span>
        <label class="govuk-label" for="field-text-search">
            Search by field name
        </label>
        <input v-bind:class="['govuk-input gias-inline-search__field', filterSearchError? 'govuk-input--error' : '']"
               id="field-text-search" v-model="filterSearchText" type="text">
        <button class="govuk-button gias-inline-search__button" v-on:click.prevent="filterFilters">Search</button>
        <a href="#" v-on:click.prevent="resetTextFilter" v-if="showClearButton">Clear search</a>
    </div>
</template>

<script>
    export default {
        name: "searchByFieldName",
        props: {
            selectedFields: Array,
            fields: Array,
        },
        data: function () {
            return {
                filterSearchText: '',
                showClearButton: false,
                filterSearchError: false,
                isResetting: false,
            }
        },
        methods: {
            filterFilters: function(){
                this.filterSearchError = false;
                if (!this.isResetting && this.filterSearchText.length === 0) {
                    this.filterSearchError = true;
                    this.$root.errorMessages = [{href: '#field-text-search', message: 'Enter a field name to search'}];

                } else {
                    this.$root.viewAsList = true;
                    this.$root.filterFilters(this.filterSearchText);
                }
                this.isResetting = false;
                this.showClearButton = this.filterSearchText.length > 0;
            },
            resetTextFilter: function(){
                this.filterSearchText = '';
                this.isResetting = true;
                this.filterFilters();
            }
        }
    }
</script>
