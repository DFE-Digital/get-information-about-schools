@using Edubase.Common
@using Edubase.Web.UI.Models.Search;
@using eStatus = Edubase.Services.Enums.eLookupEstablishmentStatus;
@using VM = Edubase.Web.UI.Models.Search.SearchViewModel;
@using Edubase.Web.UI.Helpers;
@model VM

@{
    var gSearch = "";
    if (Request.QueryString["gsearch"] != null)
    {
        gSearch = Request.QueryString["gsearch"];
    }
}
<fieldset>
    <legend>
        <h2 class="heading-small flush--top">Search by:</h2>
    </legend>
    <ul>
        <li class="search-type-wrapper">
            @using (Html.BeginRouteForm("SearchResults", FormMethod.Get, new { id = "governor-search-by-name-or-role" }))
            {
                @Html.HiddenFor(m => m.SelectedTab)
                <fieldset class="search-toggle-panel">
                    <div class="multiple-choice multiple-choice--radio">
                        @Html.RadioButtonFor(m => m.SearchType, eSearchType.Governor, new { id = "searchtype-gov-namerole", name = "gsearch", value = "name-role", data_toggle_panel = "#searchtype-gov-namerole-ref" })
                        <label for="searchtype-gov-namerole">
                            Name or role
                        </label>

                    </div>
                    <div class="panel panel-border-narrow" id="searchtype-gov-namerole-ref">
                        @* This alert gets dynamically populated *@
                        <div class="warning-message visuallyhidden" role="alert">
                            <p class="message-text" aria-live="polite"></p>
                        </div>
                        @if (Model.SearchType == eSearchType.Governor && Model.NoResults)
                        {
                            if (Model.GovernorSearchModel.Forename.IsNullOrEmpty() &&
                                Model.GovernorSearchModel.Surname.IsNullOrEmpty() &&
                                Model.GovernorSearchModel.RoleId.Length == 0)
                            {
                                @* Static alert for no search results *@
                                <div role="alert" class="warning-message js-trigger-aria-live">
                                    <p class="warning-message-text" aria-live="polite">Please enter a governor to start a search</p>
                                </div>
                            }
                            else
                            {
                                @* Static alert for no search results *@
                                <div role="alert" class="warning-message js-trigger-aria-live">
                                    <p class="warning-message-text" aria-live="polite">We could not find any governors matching your search criteria</p>
                                </div>
                            }
                        }
                        <div class="edubase-search-element">
                            <label for="forename" class="form-label">First name</label>
                            @Html.TextBoxFor(x => x.GovernorSearchModel.Forename, new { maxlength = 120, id = "forename", @class = "form-control" })
                        </div>
                        <div class="edubase-search-element">
                            <label for="surname" class="form-label">Last name</label>
                            @Html.TextBoxFor(x => x.GovernorSearchModel.Surname, new { maxlength = 120, id = "surname", @class = "form-control" })
                        </div>

                        <div class="form-group">
                            <div class="govuk-option-select form-control-1-2">
                                <div class="container-head" tabindex="0">
                                    <div class="option-select-label hard--left">Role</div>
                                    <span class="font-xsmall">For example, trustee</span>
                                </div>
                                <div class="options-container" id="governor-roles">
                                    <fieldset>
                                        @foreach (var governorRole in Model.GovernorRoles)
                                        {
                                            <div class="multiple-choice multiple-choice--smaller multiple-choice--list">
                                                <input name="GovernorSearchModel.RoleId"
                                                       id="govrole-@governorRole.Id.ToString()" value="@governorRole.Id.ToString()" type="checkbox"
                                                       @if (Model.GovernorSearchModel.RoleId.Contains(governorRole.Id))
                                                       {
                                                           <text>checked="checked"</text>
                                                       }
                                                       />
                                                <label for="govrole-@governorRole.Id.ToString()">
                                                    @FormatHelpers.FirstCharToUpper(@governorRole.Name.ToLower())
                                                </label>
                                            </div>
                                        }
                                    </fieldset>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="multiple-choice">
                                @Html.CheckBoxFor(x => x.GovernorSearchModel.IncludeHistoric, new { id = "IncludeHistoricRole0" })
                                <label for="IncludeHistoricRole0">Include historic records (governors who stepped down in the last 12 months)</label>
                            </div>
                        </div>

                        <div class="form-group">
                            <button type="submit" id="governor-search-submit" class="button" name="searchtype" value="@eSearchType.Governor">Search</button>
                        </div>
                    </div>
                </fieldset>
            }
        </li>
        @if (User.Identity.IsAuthenticated)
                                                       {
            <li class="search-type-wrapper">
                @using (Html.BeginRouteForm("SearchResults", FormMethod.Get))
                {
                    @Html.HiddenFor(m => m.SelectedTab)
                    <fieldset class="search-toggle-panel">
                        <div class="multiple-choice multiple-choice--radio">
                            @Html.RadioButtonFor(m => m.SearchType, eSearchType.GovernorReference, new { id = "searchtype-gov-refno", name = "gsearch", value = "gid", data_toggle_panel = "#searchtype-gov-refno-ref" })
                            <label for="searchtype-gov-refno">
                                Reference number
                            </label>
                        </div>
                        <div class="panel panel-border-narrow" id="searchtype-gov-refno-ref">
                            @* This alert gets dynamically populated *@
                            <div class="warning-message visuallyhidden" role="alert">
                                <p class="message-text" aria-live="polite"></p>
                            </div>
                            @if (Model.SearchType == eSearchType.GovernorReference && Model.NoResults)
                            {
                                if (!Model.GovernorSearchModel.Gid.HasValue)
                                {
                                @* Static alert for no search results *@
                                    <div role="alert" class="warning-message js-trigger-aria-live">
                                        <p class="warning-message-text" aria-live="polite">Please enter a governor ID to start a search</p>
                                    </div>
                                }
                                else
                                {
                                @* Static alert for no search results *@
                                    <div role="alert" class="warning-message js-trigger-aria-live">
                                        <p class="warning-message-text" aria-live="polite">We could not find any governors matching your search criteria</p>
                                    </div>
                                }
                            }
                            <div class="form-group @Html.ValidationCssClassFor(x => x.GovernorSearchModel.Gid)">
                                <label for="GovernorSearchModel_Gid" class="form-label">
                                    Enter governor ID number (GID number)
                                </label>
                                @Html.ValidationMessageFor(x => x.GovernorSearchModel.Gid)
                                @Html.TextBoxFor(x => x.GovernorSearchModel.Gid, new { maxlength = 10, @class = "form-control form-control-1-2" })
                            </div>

                            <div class="form-group">
                                <div class="multiple-choice">
                                    @Html.CheckBoxFor(x => x.GovernorSearchModel.IncludeHistoric, new { id = "IncludeHistoricRole1" })
                                    <label for="IncludeHistoricRole1">Include historic records (governors who stepped down in the last 12 months)</label>
                                </div>
                            </div>

                            <div class="form-group">

                                <button type="submit" id="governor-search-submit-1" class="button" name="searchtype" value="@eSearchType.GovernorReference">Search</button>
                            </div>

                        </div>
                    </fieldset>
                }
            </li>
        }

        <li aria-hidden="true">
            <p>or</p>
        </li>

        <li class="search-type-wrapper">
            @using (Html.BeginRouteForm("SearchResults", FormMethod.Get))
            {
                @Html.HiddenFor(m => m.SelectedTab)

                <fieldset class="search-toggle-panel">
                    <div class="multiple-choice multiple-choice--radio">
                        <input type="radio" id="searchtype-gov-all" data-toggle-panel="#searchtype-gov-all-ref" name="gsearch" value="all"
                        @Html.Conditional(gSearch == "all", "checked=checked") />
                        <label for="searchtype-gov-all">All governors</label>
                    </div>
                    <div class="panel panel-border-narrow" id="searchtype-gov-all-ref">
                        <div class="form-group">
                            <div class="multiple-choice">
                                @Html.CheckBoxFor(x => x.GovernorSearchModel.IncludeHistoric, new {id = "IncludeHistoricRole2"})
                                <label for="IncludeHistoricRole2">Include historic records (governors who stepped down in the last 12 months)</label>
                            </div>
                        </div>

                        <div class="form-group">
                            <button type="submit" id="governor-search-submit-2" class="button" name="searchtype" value="@eSearchType.GovernorAll">Search</button>
                        </div>

                    </div>
                </fieldset>
            }
        </li>
    </ul>

</fieldset>
